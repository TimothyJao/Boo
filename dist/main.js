!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s=1280,h=720,o=1.33,a=Math.sqrt(2*o),r=20,n=50,l={mario:{up:[],upright:[],right:[],downright:[],down:[],downleft:[],left:[],upleft:[]},boo:{left:{attacking:[],hiding:[]},right:{attacking:[],hiding:[]}},game_over:[]},c={W:87,A:65,S:83,D:68,W:87,UP:38,LEFT:37,DOWN:40,RIGHT:39,SPACE:32,ENTER:13},d={UP:[0,-1],LEFT:[-1,0],DOWN:[0,1],RIGHT:[1,0],ZERO:[0,0]},g=t=>{let e=0;let i=0;["up","upright","right","downright","down","downleft","left","upleft"].forEach(t=>{for(let e=1;e<=8;e++){i+=1;let s=new Image;s.onload=h,s.src=`./vendors/mario/mario_${t}_${e}.png`,l.mario[t].push(s)}});for(let t=1;t<=5;t++){i+=1;let e=new Image;e.onload=h,e.src=`./vendors/boo/boo_left_hiding_${t}.png`,l.boo.left.hiding.push(e)}for(let t=1;t<=5;t++){i+=1;let e=new Image;e.onload=h,e.src=`./vendors/boo/boo_right_hiding_${t}.png`,l.boo.right.hiding.push(e)}for(let t=1;t<=5;t++){i+=1;let e=new Image;e.onload=h,e.src=`./vendors/boo/boo_left_attacking_${t}.png`,l.boo.left.attacking.push(e)}for(let t=1;t<=5;t++){i+=1;let e=new Image;e.onload=h,e.src=`./vendors/boo/boo_right_attacking_${t}.png`,l.boo.right.attacking.push(e)}let s=new Image;function h(){++e>=i&&t()}s.onload=h,s.src="./vendors/gameover/browser.png",l.game_over.push(s)};var m=class{constructor(t=[s/2,h/2-20],e=[0,0],i="down",o=3){this.pos=t,this.vel=e,this.direction=i,this.imageCount=o,this.counter=0,this.hitbox={x:12,y:9,width:7,height:19},this.flashLightOn=!1,this.flashLightPower=100,this.mustRecharge=!1}image(){return l.mario[this.direction][this.imageCount]}changeDirection(){0===this.vel[0]&&this.vel[1]===-o?this.direction="up":0===this.vel[0]&&this.vel[1]===o?this.direction="down":this.vel[0]===o&&0===this.vel[1]?this.direction="right":this.vel[0]===-o&&0===this.vel[1]?this.direction="left":this.vel[0]===o&&this.vel[1]===o?this.direction="downright":this.vel[0]===-o&&this.vel[1]===o?this.direction="downleft":this.vel[0]===o&&this.vel[1]===-o?this.direction="upright":this.vel[0]===-o&&this.vel[1]===-o&&(this.direction="upleft"),this.imageCount=3}move(){this.canMove()&&(Math.abs(this.vel[0])===Math.abs(this.vel[1])?this.pos=[this.pos[0]+this.vel[0]/a,this.pos[1]+this.vel[1]/a]:this.pos=[this.pos[0]+this.vel[0],this.pos[1]+this.vel[1]],this.counter++,this.counter>8&&(this.counter=0,0==this.vel[0]&&0==this.vel[1]||(this.imageCount=(this.imageCount+1)%8)))}canMove(){return!(this.pos[0]>s-22&&this.vel[0]>0||this.pos[0]<0&&this.vel[0]<0||this.pos[1]>h-38&&this.vel[1]>0||this.pos[1]<0&&this.vel[1]<0)}addVelocity(t){t=[t[0]*o,t[1]*o],this.vel=[this.vel[0]+t[0],this.vel[1]+t[1]],this.changeDirection()}removeVelocity(t){t=[t[0]*o,t[1]*o],this.vel=[this.vel[0]-t[0],this.vel[1]-t[1]],this.changeDirection()}discharge(){this.flashLightPower>=0&&!this.mustRecharge?this.flashLightPower-=1:(this.mustRecharge=!0,this.flashLightOn=!1)}recharge(){this.flashLightPower<100&&(this.flashLightPower+=.3,this.flashLightPower>50&&(this.mustRecharge=!1))}flashLight(){this.flashLightOn?this.flashLightOn=!1:this.flashLightOn||this.mustRecharge||(this.flashLightOn=!0)}};Window.image=l;var u=class{constructor(t,e=[0,0],i="left",s=0,h="attacking"){this.pos=t,this.vel=e,this.direction=i,this.imageCount=s,this.state=h,this.counter=0,this.hidingCounter=0,this.hitbox={x:15,y:11,radius:8},this.currentImage="",this.image=this.image.bind(this)}image(){return this.currentImage=l.boo[this.direction][this.state][this.imageCount],this.currentImage}nextMove(t,e){if(e)if("attacking"===this.state){let e=t.pos[0]-this.pos[0],i=t.pos[1]-this.pos[1],s=Math.sqrt(e*e+i*i);this.vel=[o*e/s/2,o*i/s/2],this.direction=e>0?"right":"left"}else"hiding"===this.state&&(this.vel=[0,0]);else this.vel=[0,0]}hide(){this.state="hiding",this.hidingCounter=0}incrementHiding(){this.hidingCounter++,this.hidingCounter>=300&&(this.state="attacking",this.hidingCounter=0)}move(){this.pos=[this.pos[0]+this.vel[0],this.pos[1]+this.vel[1]],this.counter++,this.counter>12&&(this.counter=0,this.imageCount=(this.imageCount+1)%l.boo[this.direction][this.state].length)}addVelocity(t){t=[t[0]*o,t[1]*o],this.vel=[this.vel[0]+t[0],this.vel[1]+t[1]],this.changeDirection()}removeVelocity(t){t=[t[0]*o,t[1]*o],this.vel=[this.vel[0]-t[0],this.vel[1]-t[1]],this.changeDirection()}checkCollision(t){let e=t.pos[0]+t.hitbox.x,i=(t.pos[0],t.hitbox.x,t.hitbox.width,t.pos[1]+t.hitbox.y),s=(t.pos[1],t.hitbox.y,t.hitbox.height,this.pos[0]+this.hitbox.x),h=(this.pos[0],this.hitbox.x,this.hitbox.width,this.pos[1]+this.hitbox.y),o=(this.pos[1],this.hitbox.y,this.hitbox.height,Math.abs(s-e-t.hitbox.width/2)),a=Math.abs(h-i-t.hitbox.height/2);if(o<t.hitbox.width/2+this.hitbox.radius&&a<t.hitbox.height/2+this.hitbox.radius)return!0}};const b=(t,e,i)=>{let s,h,o,a,r=i.pos[0]+14,n=i.pos[1]+20;switch(i.direction){case"down":s=r-200*Math.tan(22.5*Math.PI/180),h=n+200,o=r+200*Math.tan(22.5*Math.PI/180),a=n+200,t.lineTo(s,h),t.lineTo(o,a),t.moveTo(r,n),e||t.arc(r,n,100,3*Math.PI/8,5*Math.PI/8);break;case"downright":s=r+200*Math.tan(22.5*Math.PI/180),h=n+200,o=r+200,a=n+200*Math.tan(22.5*Math.PI/180),t.lineTo(s,h),t.lineTo(o,a),t.moveTo(r,n),e||t.arc(r,n,100,Math.PI/8,3*Math.PI/8);break;case"right":s=r+200,h=n+200*Math.tan(22.5*Math.PI/180),o=r+200,a=n-200*Math.tan(22.5*Math.PI/180),t.lineTo(s,h),t.lineTo(o,a),t.moveTo(r,n),e||t.arc(r,n,100,15*Math.PI/8,Math.PI/8);break;case"upright":s=r+200,h=n-200*Math.tan(22.5*Math.PI/180),o=r+200*Math.tan(22.5*Math.PI/180),a=n-200,t.lineTo(s,h),t.lineTo(o,a),t.moveTo(r,n),e||t.arc(r,n,100,13*Math.PI/8,15*Math.PI/8);break;case"up":s=r+200*Math.tan(22.5*Math.PI/180),h=n-200,o=r-200*Math.tan(22.5*Math.PI/180),a=n-200,t.lineTo(s,h),t.lineTo(o,a),t.moveTo(r,n),e||t.arc(r,n,100,11*Math.PI/8,13*Math.PI/8);break;case"upleft":s=r-200*Math.tan(22.5*Math.PI/180),h=n-200,o=r-200,a=n-200*Math.tan(22.5*Math.PI/180),t.lineTo(s,h),t.lineTo(o,a),t.moveTo(r,n),e||t.arc(r,n,100,9*Math.PI/8,11*Math.PI/8);break;case"left":s=r-200,h=n-200*Math.tan(22.5*Math.PI/180),o=r-200,a=n+200*Math.tan(22.5*Math.PI/180),t.lineTo(s,h),t.lineTo(o,a),t.moveTo(r,n),e||t.arc(r,n,100,7*Math.PI/8,9*Math.PI/8);break;case"downleft":s=r-200,h=n+200*Math.tan(22.5*Math.PI/180),o=r-200*Math.tan(22.5*Math.PI/180),a=n+200,t.lineTo(s,h),t.lineTo(o,a),t.moveTo(r,n),e||t.arc(r,n,100,5*Math.PI/8,7*Math.PI/8)}return{point1:[r,n],point2:[s,h],point3:[o,a]}},f=(t,e,i)=>{if(t=[t[0]+10,t[1]+10],!e.flashLightOn)return;let s=i.point1,h=i.point2,o=i.point3;return p(s,h,o)===p(s,h,t)+p(s,o,t)+p(h,o,t)},p=(t,e,i)=>{let s=(t[0]*(e[1]-i[1])+e[0]*(i[1]-t[1])+i[0]*(t[1]-e[1]))/2;return Math.abs(s)},v=(t,e)=>{let i=e.pos[0]+14,s=e.pos[1]+20;switch(e.direction){case"down":t.arc(i,s,100,3*Math.PI/8,5*Math.PI/8,!0);break;case"downright":t.arc(i,s,100,Math.PI/8,3*Math.PI/8,!0);break;case"right":t.arc(i,s,100,15*Math.PI/8,Math.PI/8,!0);break;case"upright":t.arc(i,s,100,13*Math.PI/8,15*Math.PI/8,!0);break;case"up":t.arc(i,s,100,11*Math.PI/8,13*Math.PI/8,!0);break;case"upleft":t.arc(i,s,100,9*Math.PI/8,11*Math.PI/8,!0);break;case"left":t.arc(i,s,100,7*Math.PI/8,9*Math.PI/8,!0);break;case"downleft":t.arc(i,s,100,5*Math.PI/8,7*Math.PI/8,!0)}};class w{constructor(){this.mario=new m,this.boos=[],this.darknessCounter=0,this.dead=!1,this.lightRange={},this.browserScaler=0,this.score=0,this.gameOverChange=!1,this.booRandomPosition=this.booRandomPosition.bind(this),this.checkCollisions=this.checkCollisions.bind(this),this.drawDarkness=this.drawDarkness.bind(this),this.trueDarkness=this.trueDarkness.bind(this)}addBoo(){if(!this.dead){if(this.boos.length>r){let t=Math.floor(Math.random()*r);this.boos.splice(t,1)}this.boos.push(new u(this.booRandomPosition()))}}booRandomPosition(){let t=Math.floor(Math.random()*s),e=Math.floor(Math.random()*h),i=[t,e];return(this.mario.pos[0]>=t-n&&this.mario.pos[0]<=t+n||this.mario.pos[1]>=e-n&&this.mario.pos[1]<=e+n)&&(i=this.booRandomPosition()),i}draw(t){t.clearRect(0,0,s,h),t.fillStyle="#888888",t.fillRect(0,0,s,h),t.drawImage(this.mario.image(),this.mario.pos[0],this.mario.pos[1]);for(let e=0;e<this.boos.length;e++){let i=this.boos[e];i.nextMove(this.mario,!this.dead),t.drawImage(i.image(),i.pos[0],i.pos[1])}this.dead?this.dead&&this.darknessCounter<50?this.trueDarkness(t):this.darknessCounter>=50&&this.browserScaler<1.3&&this.gameOverScreen(t):this.drawDarkness(t),this.browserScaler>=1.3&&(this.gameOverChange=!0)}drawDarkness(t){let e=this.mario.pos[0]+14,i=this.mario.pos[1]+20;t.beginPath(),t.arc(e,i,100,0,2*Math.PI,!0),t.moveTo(e,i),this.mario.flashLightOn&&(this.lightRange=b(t,!1,this.mario)),t.rect(s,h,-s,-h),t.fillStyle="black",t.fill();let o=t.createRadialGradient(e,i,50,e,i,120);if(o.addColorStop(0,"transparent"),o.addColorStop(1,"black"),t.fillStyle=o,t.moveTo(e,i),this.mario.flashLightOn?v(t,this.mario):t.arc(e,i,100,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),this.mario.flashLightOn){let s=t.createLinearGradient(e,i,150,0);s.addColorStop(0,"rgba(255, 255, 220, 0.2)"),s.addColorStop(1,"rgba(0, 0, 0, 0.2)"),t.moveTo(e,i),this.lightRange=b(t,!0,this.mario),t.fillStyle="rgba(255, 255, 200, 0.4)",t.fill()}}trueDarkness(t){this.darknessCounter+=.5;let e=this.mario.pos[0]+14,i=this.mario.pos[1]+20;t.beginPath(),t.fillStyle="black",t.arc(e,i,100,0,2*Math.PI),t.rect(s,0,-s,h),t.fill(),t.closePath(),t.beginPath();let o=t.createRadialGradient(e,i,50-this.darknessCounter,e,i,100-2*this.darknessCounter);o.addColorStop(0,"transparent"),o.addColorStop(1,"black"),50===this.darknessCounter?t.fillStyle="black":t.fillStyle=o,t.arc(e,i,120,0,2*Math.PI),t.fill(),t.closePath()}gameOverScreen(t){t.fillStyle="black",t.fillRect(0,0,s,h);let e=l.game_over[0],i=e.width*this.browserScaler,o=e.height*this.browserScaler;t.drawImage(e,s/2-i/2,h/2-o/2,i,o),this.browserScaler+=.004}moveObjects(){for(let t=0;t<this.allObjects().length;t++)this.allObjects()[t].move()}checkCollisions(){for(let t=0;t<this.boos.length;t++)this.boos[t].checkCollision(this.mario)?this.gameOver():f(this.boos[t].pos,this.mario,this.lightRange)?this.boos[t].hide():"hiding"===this.boos[t].state&&this.boos[t].incrementHiding()}step(){this.moveObjects(),this.checkCollisions()}allObjects(){let t=Object.assign([],this.boos);return t.push(this.mario),t}gameOver(){this.mario.vel=[0,0],this.dead=!0}}const P=t=>{M(t),k(t),y(t)},M=t=>{t.clearRect(0,0,s,h),t.fillStyle="black",t.fillRect(0,0,s,h)},k=t=>{t.beginPath(),t.fillStyle="white",t.textAlign="center",t.shadowColor="white",t.shadowBlur=4,t.font="80px SuperMario256",t.fillText("Boo",s/2,150),t.closePath()},y=t=>{t.beginPath(),t.strokeStyle="white",t.fillStyle="white",t.textAlign="center",t.font="30px SuperMario256";const e="Press ENTER to begin";t.shadowColor="white",t.shadowBlur=4,t.fillText(e,s/2,250),t.closePath();const i=t.measureText(e).width,h=s/2-i/2;t.beginPath(),t.textAlign="left",t.font="30px SuperMario256",t.fillText("Instructions",h,340),t.fillText("Controls",h,520),t.font="20px SuperMario256",t.fillText("- Avoid boos at all costs",h+20,370),t.fillText("- Use your flashlight to stun boos",h+20,400),t.fillText("- Your flashlight has a short battery",h+20,430),t.fillText("life and a long recharge time",h+40,460),t.fillText("- WASD to MOVE",h+20,550),t.fillText("- SPACE to TURN ON FLASHLIGHT",h+20,580),t.fillStyle="",t.shadowBlur="",t.closePath()},I=(t,e)=>{x(t),C(t),S(t,e)},x=t=>{t.clearRect(0,0,s,h),t.fillStyle="black",t.fillRect(0,0,s,h)},C=t=>{t.beginPath(),t.fillStyle="white",t.textAlign="center",t.shadowColor="white",t.shadowBlur=5,t.font="50px SuperMario256",t.fillText("Game Over",s/2,150),t.closePath()},S=(t,e)=>{t.beginPath(),t.strokeStyle="white",t.fillStyle="white",t.textAlign="center",t.font="50px SuperMario256";const i="Press ENTER to play again";t.shadowColor="white",t.shadowBlur=5,t.fillText(i,s/2,450),t.closePath();t.measureText(i).width;t.beginPath(),t.font="30px SuperMario256",t.fillText("Score: "+e,s/2,240),t.fillStyle="",t.shadowBlur="",t.closePath()};class T{constructor(t){this.game=new w,this.ctx=t,this.mario=this.game.mario,this.state="title",this.keyDown={},this.handleKeydown=this.handleKeydown.bind(this),this.handleKeyup=this.handleKeyup.bind(this),this.ghostCounter=0,this.flashlightCounter=0,this.step=this.step.bind(this),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup)}start(){g(()=>{requestAnimationFrame(this.step)})}step(){let t=this;setTimeout(function(){switch(t.state){case"title":P(t.ctx);break;case"game":t.ghostCounter++,t.ghostCounter>20&&(t.ghostCounter=0,t.game.addBoo()),t.game.draw(t.ctx),t.game.step(),t.mario.flashLightOn?t.mario.discharge():t.mario.recharge(),t.game.dead||t.game.score++,t.game.gameOverChange&&(t.state="gameOver");break;case"gameOver":I(t.ctx,t.game.score)}requestAnimationFrame(t.step)},1e3/60)}handleKeydown(t){if(!t.repeat&&!this.keyDown[t.keyCode]&&(t.keyCode===c.ENTER&&("title"!==this.state&&"gameOver"!==this.state||(this.state="game",this.game=new w,this.mario=this.game.mario,this.keyDown={})),!this.game.dead))switch(t.keyCode){case c.W:this.mario.addVelocity(d.UP),this.keyDown[c.W]=!0;break;case c.A:this.mario.addVelocity(d.LEFT),this.keyDown[c.A]=!0;break;case c.S:this.mario.addVelocity(d.DOWN),this.keyDown[c.S]=!0;break;case c.D:this.mario.addVelocity(d.RIGHT),this.keyDown[c.D]=!0;break;case c.SPACE:this.mario.flashLight(),this.keyDown[c.SPACE]=!0}}handleKeyup(t){if(!this.game.dead)switch(t.keyCode){case c.W:this.mario.removeVelocity(d.UP),this.keyDown[c.W]=!1;break;case c.A:this.mario.removeVelocity(d.LEFT),this.keyDown[c.A]=!1;break;case c.S:this.mario.removeVelocity(d.DOWN),this.keyDown[c.S]=!1;break;case c.D:this.mario.removeVelocity(d.RIGHT),this.keyDown[c.D]=!1;break;case c.SPACE:this.mario.flashLight(),this.keyDown[c.SPACE]=!1}}scaleCanvas(){documen.querySelector("#game-canvas"),this.game.GameWidth()}}document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("game-canvas");t.width=s,t.height=h;const e=t.getContext("2d");new T(e).start()})}]);