!function(t){var e={};function i(o){if(e[o])return e[o].exports;var h=e[o]={i:o,l:!1,exports:{}};return t[o].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(o,h,function(e){return t[e]}.bind(null,h));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const o=1280,h=720,s=1.33,a=Math.sqrt(2*s),r=20,l=50,n={mario:{up:[],upright:[],right:[],downright:[],down:[],downleft:[],left:[],upleft:[]},boo:{left:{attacking:[],hiding:[]},right:{attacking:[],hiding:[]}},game_over:[]},c={W:87,A:65,S:83,D:68,W:87,UP:38,LEFT:37,DOWN:40,RIGHT:39,SPACE:32,ENTER:13},d={UP:[0,-1],LEFT:[-1,0],DOWN:[0,1],RIGHT:[1,0],ZERO:[0,0]},g=t=>{let e=0;let i=0;["up","upright","right","downright","down","downleft","left","upleft"].forEach(t=>{for(let e=1;e<=8;e++){i+=1;let o=new Image;o.onload=h,o.src=`./vendors/mario/mario_${t}_${e}.png`,n.mario[t].push(o)}});for(let t=1;t<=5;t++){i+=1;let e=new Image;e.onload=h,e.src=`./vendors/boo/boo_left_hiding_${t}.png`,n.boo.left.hiding.push(e)}for(let t=1;t<=5;t++){i+=1;let e=new Image;e.onload=h,e.src=`./vendors/boo/boo_right_hiding_${t}.png`,n.boo.right.hiding.push(e)}for(let t=1;t<=5;t++){i+=1;let e=new Image;e.onload=h,e.src=`./vendors/boo/boo_left_attacking_${t}.png`,n.boo.left.attacking.push(e)}for(let t=1;t<=5;t++){i+=1;let e=new Image;e.onload=h,e.src=`./vendors/boo/boo_right_attacking_${t}.png`,n.boo.right.attacking.push(e)}let o=new Image;function h(){++e>=i&&t()}o.onload=h,o.src="./vendors/gameover/browser.png",n.game_over.push(o)};var u=class{constructor(t=[o/2,h/2-20],e=[0,0],i="down",s=3){this.pos=t,this.vel=e,this.direction=i,this.imageCount=s,this.counter=0,this.hitbox={x:12,y:9,width:7,height:19},this.flashLightOn=!1,this.flashLightPower=100,this.mustRecharge=!1}image(){return n.mario[this.direction][this.imageCount]}changeDirection(){0===this.vel[0]&&this.vel[1]===-s?this.direction="up":0===this.vel[0]&&this.vel[1]===s?this.direction="down":this.vel[0]===s&&0===this.vel[1]?this.direction="right":this.vel[0]===-s&&0===this.vel[1]?this.direction="left":this.vel[0]===s&&this.vel[1]===s?this.direction="downright":this.vel[0]===-s&&this.vel[1]===s?this.direction="downleft":this.vel[0]===s&&this.vel[1]===-s?this.direction="upright":this.vel[0]===-s&&this.vel[1]===-s&&(this.direction="upleft"),this.imageCount=3}move(){this.canMove()&&(Math.abs(this.vel[0])===Math.abs(this.vel[1])?this.pos=[this.pos[0]+this.vel[0]/a,this.pos[1]+this.vel[1]/a]:this.pos=[this.pos[0]+this.vel[0],this.pos[1]+this.vel[1]],this.counter++,this.counter>8&&(this.counter=0,0==this.vel[0]&&0==this.vel[1]||(this.imageCount=(this.imageCount+1)%8)))}canMove(){return!(this.pos[0]>o-222&&this.vel[0]>0||this.pos[0]<0&&this.vel[0]<0||this.pos[1]>h-38&&this.vel[1]>0||this.pos[1]<0&&this.vel[1]<0)}addVelocity(t){t=[t[0]*s,t[1]*s],this.vel=[this.vel[0]+t[0],this.vel[1]+t[1]],this.changeDirection()}removeVelocity(t){t=[t[0]*s,t[1]*s],this.vel=[this.vel[0]-t[0],this.vel[1]-t[1]],this.changeDirection()}discharge(){this.flashLightPower>=0&&!this.mustRecharge?this.flashLightPower-=1:(this.mustRecharge=!0,this.flashLightOn=!1)}recharge(){this.flashLightPower<100&&(this.flashLightPower+=.3,this.flashLightPower>50&&(this.mustRecharge=!1))}flashLight(){this.flashLightOn?this.flashLightOn=!1:this.flashLightOn||this.mustRecharge||(this.flashLightOn=!0)}};Window.image=n;var f=class{constructor(t,e=[0,0],i="left",o=0,h="attacking"){this.pos=t,this.vel=e,this.direction=i,this.imageCount=o,this.state=h,this.counter=0,this.hidingCounter=0,this.hitbox={x:15,y:11,radius:8},this.currentImage="",this.image=this.image.bind(this)}image(){return this.currentImage=n.boo[this.direction][this.state][this.imageCount],this.currentImage}nextMove(t,e){if(e)if("attacking"===this.state){let e=t.pos[0]-this.pos[0],i=t.pos[1]-this.pos[1],o=Math.sqrt(e*e+i*i);this.vel=[s*e/o/2,s*i/o/2],this.direction=e>0?"right":"left"}else"hiding"===this.state&&(this.vel=[0,0]);else this.vel=[0,0]}hide(){this.state="hiding",this.hidingCounter=0}incrementHiding(){this.hidingCounter++,this.hidingCounter>=300&&(this.state="attacking",this.hidingCounter=0)}move(){this.pos=[this.pos[0]+this.vel[0],this.pos[1]+this.vel[1]],this.counter++,this.counter>12&&(this.counter=0,this.imageCount=(this.imageCount+1)%n.boo[this.direction][this.state].length)}addVelocity(t){t=[t[0]*s,t[1]*s],this.vel=[this.vel[0]+t[0],this.vel[1]+t[1]],this.changeDirection()}removeVelocity(t){t=[t[0]*s,t[1]*s],this.vel=[this.vel[0]-t[0],this.vel[1]-t[1]],this.changeDirection()}checkCollision(t){let e=t.pos[0]+t.hitbox.x,i=(t.pos[0],t.hitbox.x,t.hitbox.width,t.pos[1]+t.hitbox.y),o=(t.pos[1],t.hitbox.y,t.hitbox.height,this.pos[0]+this.hitbox.x),h=(this.pos[0],this.hitbox.x,this.hitbox.width,this.pos[1]+this.hitbox.y),s=(this.pos[1],this.hitbox.y,this.hitbox.height,Math.abs(o-e-t.hitbox.width/2)),a=Math.abs(h-i-t.hitbox.height/2);if(s<t.hitbox.width/2+this.hitbox.radius&&a<t.hitbox.height/2+this.hitbox.radius)return!0}};const m=(t,e,i)=>{let o,h,s,a,r=i.pos[0]+14,l=i.pos[1]+20;switch(i.direction){case"down":o=r-200*Math.tan(22.5*Math.PI/180),h=l+200,s=r+200*Math.tan(22.5*Math.PI/180),a=l+200,t.lineTo(o,h),t.lineTo(s,a),t.moveTo(r,l),e||t.arc(r,l,100,3*Math.PI/8,5*Math.PI/8);break;case"downright":o=r+200*Math.tan(22.5*Math.PI/180),h=l+200,s=r+200,a=l+200*Math.tan(22.5*Math.PI/180),t.lineTo(o,h),t.lineTo(s,a),t.moveTo(r,l),e||t.arc(r,l,100,Math.PI/8,3*Math.PI/8);break;case"right":o=r+200,h=l+200*Math.tan(22.5*Math.PI/180),s=r+200,a=l-200*Math.tan(22.5*Math.PI/180),t.lineTo(o,h),t.lineTo(s,a),t.moveTo(r,l),e||t.arc(r,l,100,15*Math.PI/8,Math.PI/8);break;case"upright":o=r+200,h=l-200*Math.tan(22.5*Math.PI/180),s=r+200*Math.tan(22.5*Math.PI/180),a=l-200,t.lineTo(o,h),t.lineTo(s,a),t.moveTo(r,l),e||t.arc(r,l,100,13*Math.PI/8,15*Math.PI/8);break;case"up":o=r+200*Math.tan(22.5*Math.PI/180),h=l-200,s=r-200*Math.tan(22.5*Math.PI/180),a=l-200,t.lineTo(o,h),t.lineTo(s,a),t.moveTo(r,l),e||t.arc(r,l,100,11*Math.PI/8,13*Math.PI/8);break;case"upleft":o=r-200*Math.tan(22.5*Math.PI/180),h=l-200,s=r-200,a=l-200*Math.tan(22.5*Math.PI/180),t.lineTo(o,h),t.lineTo(s,a),t.moveTo(r,l),e||t.arc(r,l,100,9*Math.PI/8,11*Math.PI/8);break;case"left":o=r-200,h=l-200*Math.tan(22.5*Math.PI/180),s=r-200,a=l+200*Math.tan(22.5*Math.PI/180),t.lineTo(o,h),t.lineTo(s,a),t.moveTo(r,l),e||t.arc(r,l,100,7*Math.PI/8,9*Math.PI/8);break;case"downleft":o=r-200,h=l+200*Math.tan(22.5*Math.PI/180),s=r-200*Math.tan(22.5*Math.PI/180),a=l+200,t.lineTo(o,h),t.lineTo(s,a),t.moveTo(r,l),e||t.arc(r,l,100,5*Math.PI/8,7*Math.PI/8)}return{point1:[r,l],point2:[o,h],point3:[s,a]}},b=(t,e,i)=>{if(t=[t[0]+10,t[1]+10],!e.flashLightOn)return;let o=i.point1,h=i.point2,s=i.point3;return p(o,h,s)===p(o,h,t)+p(o,s,t)+p(h,s,t)},p=(t,e,i)=>{let o=(t[0]*(e[1]-i[1])+e[0]*(i[1]-t[1])+i[0]*(t[1]-e[1]))/2;return Math.abs(o)},w=function(t,e){let i,s=e.pos[0]+14,a=e.pos[1]+20;t.beginPath(),t.arc(s,a,100,0,2*Math.PI,!0),t.moveTo(s,a),e.flashLightOn&&(i=m(t,!1,e)),t.rect(o-200,h,-o,-h),t.fillStyle="black",t.fill();let r=t.createRadialGradient(s,a,50,s,a,120);if(r.addColorStop(0,"transparent"),r.addColorStop(1,"black"),t.fillStyle=r,t.moveTo(s,a),e.flashLightOn?((t,e)=>{let i=e.pos[0]+14,o=e.pos[1]+20;switch(e.direction){case"down":t.arc(i,o,100,3*Math.PI/8,5*Math.PI/8,!0);break;case"downright":t.arc(i,o,100,Math.PI/8,3*Math.PI/8,!0);break;case"right":t.arc(i,o,100,15*Math.PI/8,Math.PI/8,!0);break;case"upright":t.arc(i,o,100,13*Math.PI/8,15*Math.PI/8,!0);break;case"up":t.arc(i,o,100,11*Math.PI/8,13*Math.PI/8,!0);break;case"upleft":t.arc(i,o,100,9*Math.PI/8,11*Math.PI/8,!0);break;case"left":t.arc(i,o,100,7*Math.PI/8,9*Math.PI/8,!0);break;case"downleft":t.arc(i,o,100,5*Math.PI/8,7*Math.PI/8,!0)}})(t,e):t.arc(s,a,100,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),e.flashLightOn){let o=t.createLinearGradient(s,a,150,0);o.addColorStop(0,"rgba(255, 255, 220, 0.2)"),o.addColorStop(1,"rgba(0, 0, 0, 0.2)"),t.moveTo(s,a),i=m(t,!0,e),t.fillStyle="rgba(255, 255, 200, 0.4)",t.fill()}return i},v=function(t,e,i){i+=.5;let s=e.pos[0]+14,a=e.pos[1]+20;t.beginPath(),t.fillStyle="black",t.arc(s,a,100,0,2*Math.PI),t.rect(o,0,-o,h),t.fill(),t.closePath(),t.beginPath();let r=t.createRadialGradient(s,a,50-i,s,a,100-2*i);return r.addColorStop(0,"transparent"),r.addColorStop(1,"black"),t.fillStyle=50===i?"black":r,t.arc(s,a,120,0,2*Math.PI),t.fill(),t.closePath(),i},P=function(t,e){t.fillStyle="black",t.fillRect(0,0,o,h);let i=n.game_over[0],s=i.width*e,a=i.height*e;return t.drawImage(i,o/2-s/2,h/2-a/2,s,a),e+=.004},M=function(t,e){t.beginPath(),t.fillStyle="white",t.textAlign="center",t.shadowColor="white",t.shadowBlur=2,t.font="20x SuperMario256",t.fillText("Score:",o-100,30),t.fillText(e,o-100,60),t.shadowBlur=0,t.closePath()},y=function(t,e){t.beginPath(),t.fillStyle="white",t.textAlign="center",t.shadowColor="white",t.shadowBlur=2,t.font="20x SuperMario256",t.fillText("Flashlight:",o-100,100),t.shadowBlur=0,t.closePath(),t.beginPath(),t.fillStyle="white",t.fillRect(o-177,115,150,20),e.flashLightPower<50&&e.mustRecharge?t.fillStyle="red":t.fillStyle="green",t.fillRect(o-177,115,150*e.flashLightPower/100,20),t.closePath()};class k{constructor(){this.mario=new u,this.boos=[],this.darknessCounter=0,this.dead=!1,this.lightRange={},this.browserScaler=0,this.score=0,this.batteryColor="green",this.gameOverChange=!1,this.booRandomPosition=this.booRandomPosition.bind(this),this.checkCollisions=this.checkCollisions.bind(this)}addBoo(){if(!this.dead){if(this.boos.length>r){let t=Math.floor(Math.random()*r);this.boos.splice(t,1)}this.boos.push(new f(this.booRandomPosition()))}}booRandomPosition(){let t=Math.floor(Math.random()*(o-200)),e=Math.floor(Math.random()*h),i=[t,e];return(this.mario.pos[0]>=t-l&&this.mario.pos[0]<=t+l||this.mario.pos[1]>=e-l&&this.mario.pos[1]<=e+l)&&(i=this.booRandomPosition()),i}draw(t){t.clearRect(0,0,o-200,h),t.fillStyle="#888888",t.fillRect(0,0,o,h),t.drawImage(this.mario.image(),this.mario.pos[0],this.mario.pos[1]);for(let e=0;e<this.boos.length;e++){let i=this.boos[e];i.nextMove(this.mario,!this.dead),t.drawImage(i.image(),i.pos[0],i.pos[1])}this.dead?this.dead&&this.darknessCounter<50?this.darknessCounter=v(t,this.mario,this.darknessCounter):this.darknessCounter>=50&&this.browserScaler<1.3&&(this.browserScaler=P(t,this.browserScaler)):(this.lightRange=w(t,this.mario),this.drawBorder(t),M(t,this.score),y(t,this.mario)),this.browserScaler>=1.3&&(this.gameOverChange=!0)}drawBorder(t){t.beginPath(),t.fillStyle="black",t.fillRect(o-200,0,200,h),t.closePath()}moveObjects(){for(let t=0;t<this.allObjects().length;t++)this.allObjects()[t].move()}checkCollisions(){for(let t=0;t<this.boos.length;t++)this.boos[t].checkCollision(this.mario)?this.gameOver():b(this.boos[t].pos,this.mario,this.lightRange)?this.boos[t].hide():"hiding"===this.boos[t].state&&this.boos[t].incrementHiding()}step(){this.moveObjects(),this.checkCollisions()}allObjects(){let t=Object.assign([],this.boos);return t.push(this.mario),t}gameOver(){this.mario.vel=[0,0],this.dead=!0}}const x=t=>{I(t),S(t),T(t)},I=t=>{t.clearRect(0,0,o,h),t.fillStyle="black",t.fillRect(0,0,o,h)},S=t=>{t.beginPath(),t.fillStyle="white",t.textAlign="center",t.shadowColor="white",t.shadowBlur=4,t.font="80px SuperMario256",t.fillText("Boo",o/2,150),t.closePath()},T=t=>{t.beginPath(),t.strokeStyle="white",t.fillStyle="white",t.textAlign="center",t.font="30px SuperMario256";const e="Press ENTER to begin";t.shadowColor="white",t.shadowBlur=2,t.fillText(e,o/2,250),t.closePath();const i=t.measureText(e).width,h=o/2-i/2;t.beginPath(),t.textAlign="left",t.font="30px SuperMario256",t.fillText("Instructions",h,340),t.fillText("Controls",h,530),t.font="20px SuperMario256",t.fillText("- Avoid boos at all costs",h,370),t.fillText("- Use your flashlight to stun boos",h,400),t.fillText("- If you discharge your whole battery, you cannot",h,430),t.fillText("use your flashlight until it recharges to 50%",h+20,460),t.fillText("- WASD to MOVE",h,560),t.fillText("- SPACE to TURN ON FLASHLIGHT",h,590),t.fillStyle="",t.shadowBlur="",t.closePath()},C=(t,e)=>{O(t),R(t),L(t,e)},O=t=>{t.clearRect(0,0,o,h),t.fillStyle="black",t.fillRect(0,0,o,h)},R=t=>{t.beginPath(),t.fillStyle="white",t.textAlign="center",t.shadowColor="white",t.shadowBlur=5,t.font="50px SuperMario256",t.fillText("Game Over",o/2,150),t.closePath()},L=(t,e)=>{t.beginPath(),t.strokeStyle="white",t.fillStyle="white",t.textAlign="center",t.font="50px SuperMario256";const i="Press ENTER to play again";t.shadowColor="white",t.shadowBlur=5,t.fillText(i,o/2,450),t.closePath();t.measureText(i).width;t.beginPath(),t.font="30px SuperMario256",t.fillText("Score: "+e,o/2,240),t.fillStyle="",t.shadowBlur="",t.closePath()};class D{constructor(t){this.game=new k,this.ctx=t,this.mario=this.game.mario,this.state="title",this.keyDown={},this.handleKeydown=this.handleKeydown.bind(this),this.handleKeyup=this.handleKeyup.bind(this),this.ghostCounter=0,this.flashlightCounter=0,this.step=this.step.bind(this),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup)}start(){g(()=>{requestAnimationFrame(this.step)})}step(){let t=this;setTimeout(function(){switch(t.state){case"title":x(t.ctx);break;case"game":t.ghostCounter++,t.ghostCounter>20&&(t.ghostCounter=0,t.game.addBoo()),t.game.draw(t.ctx),t.game.step(),t.mario.flashLightOn?t.mario.discharge():t.mario.recharge(),t.game.dead||t.game.score++,t.game.gameOverChange&&(t.state="gameOver");break;case"gameOver":C(t.ctx,t.game.score)}requestAnimationFrame(t.step)},1e3/60)}handleKeydown(t){if(!t.repeat&&!this.keyDown[t.keyCode]&&(t.keyCode===c.ENTER&&("title"!==this.state&&"gameOver"!==this.state||(this.state="game",this.game=new k,this.mario=this.game.mario,this.keyDown={})),!this.game.dead))switch(t.keyCode){case c.W:this.mario.addVelocity(d.UP),this.keyDown[c.W]=!0;break;case c.A:this.mario.addVelocity(d.LEFT),this.keyDown[c.A]=!0;break;case c.S:this.mario.addVelocity(d.DOWN),this.keyDown[c.S]=!0;break;case c.D:this.mario.addVelocity(d.RIGHT),this.keyDown[c.D]=!0;break;case c.SPACE:this.mario.flashLight(),this.keyDown[c.SPACE]=!0}}handleKeyup(t){if(!this.game.dead)switch(t.keyCode){case c.W:this.mario.removeVelocity(d.UP),this.keyDown[c.W]=!1;break;case c.A:this.mario.removeVelocity(d.LEFT),this.keyDown[c.A]=!1;break;case c.S:this.mario.removeVelocity(d.DOWN),this.keyDown[c.S]=!1;break;case c.D:this.mario.removeVelocity(d.RIGHT),this.keyDown[c.D]=!1;break;case c.SPACE:this.mario.flashLight(),this.keyDown[c.SPACE]=!1}}scaleCanvas(){documen.querySelector("#game-canvas"),this.game.GameWidth()}}document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("game-canvas");t.width=o,t.height=h;const e=t.getContext("2d");new D(e).start()})}]);