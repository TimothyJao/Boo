!function(t){var i={};function e(h){if(i[h])return i[h].exports;var o=i[h]={i:h,l:!1,exports:{}};return t[h].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=i,e.d=function(t,i,h){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:h})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var h=Object.create(null);if(e.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)e.d(h,o,function(i){return t[i]}.bind(null,o));return h},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i);const h=1280,o=720,s=1,a=Math.sqrt(2),r=50,n={mario:{up:[],upright:[],right:[],downright:[],down:[],downleft:[],left:[],upleft:[]},boo:{left:{attacking:[],hiding:[]},right:{attacking:[],hiding:[]}},game_over:[]},l={W:87,A:65,S:83,D:68,W:87,UP:38,LEFT:37,DOWN:40,RIGHT:39,SPACE:32,ENTER:13},c={UP:[0,-1],LEFT:[-1,0],DOWN:[0,1],RIGHT:[1,0],ZERO:[0,0]},d=t=>{let i=0;let e=0;["up","upright","right","downright","down","downleft","left","upleft"].forEach(t=>{for(let i=1;i<=8;i++){e+=1;let h=new Image;h.onload=o,h.src=`./vendors/mario/mario_${t}_${i}.png`,n.mario[t].push(h)}});for(let t=1;t<=5;t++){e+=1;let i=new Image;i.onload=o,i.src=`./vendors/boo/boo_left_hiding_${t}.png`,n.boo.left.hiding.push(i)}for(let t=1;t<=5;t++){e+=1;let i=new Image;i.onload=o,i.src=`./vendors/boo/boo_right_hiding_${t}.png`,n.boo.right.hiding.push(i)}for(let t=1;t<=5;t++){e+=1;let i=new Image;i.onload=o,i.src=`./vendors/boo/boo_left_attacking_${t}.png`,n.boo.left.attacking.push(i)}for(let t=1;t<=5;t++){e+=1;let i=new Image;i.onload=o,i.src=`./vendors/boo/boo_right_attacking_${t}.png`,n.boo.right.attacking.push(i)}let h=new Image;function o(){++i>=e&&t()}h.onload=o,h.src="./vendors/gameover/browser.png",n.game_over.push(h)};class g{constructor(t,i,e,h){this.pos=t,this.vel=i,this.direction=e,this.imageCount=h}}var m=class extends g{constructor(t=[h/2,o/2-20],i=[0,0],e="down",s=3){super(t,i,e,s),this.counter=0,this.hitbox={x:12,y:9,width:7,height:19},this.flashLightOn=!1,this.flashLightPower=100,this.mustRecharge=!1}image(){return n.mario[this.direction][this.imageCount]}changeDirection(){0===this.vel[0]&&this.vel[1]===-s?this.direction="up":0===this.vel[0]&&this.vel[1]===s?this.direction="down":this.vel[0]===s&&0===this.vel[1]?this.direction="right":this.vel[0]===-s&&0===this.vel[1]?this.direction="left":this.vel[0]===s&&this.vel[1]===s?this.direction="downright":this.vel[0]===-s&&this.vel[1]===s?this.direction="downleft":this.vel[0]===s&&this.vel[1]===-s?this.direction="upright":this.vel[0]===-s&&this.vel[1]===-s&&(this.direction="upleft"),this.imageCount=3}move(){this.canMove()&&(Math.abs(this.vel[0])===Math.abs(this.vel[1])?this.pos=[this.pos[0]+this.vel[0]/a,this.pos[1]+this.vel[1]/a]:this.pos=[this.pos[0]+this.vel[0],this.pos[1]+this.vel[1]],this.counter++,this.counter>8&&(this.counter=0,0==this.vel[0]&&0==this.vel[1]||(this.imageCount=(this.imageCount+1)%8)))}canMove(){return!(this.pos[0]>h-22&&this.vel[0]>0||this.pos[0]<0&&this.vel[0]<0||this.pos[1]>o-38&&this.vel[1]>0||this.pos[1]<0&&this.vel[1]<0)}addVelocity(t){t=[t[0]*s,t[1]*s],this.vel=[this.vel[0]+t[0],this.vel[1]+t[1]],this.changeDirection()}removeVelocity(t){t=[t[0]*s,t[1]*s],this.vel=[this.vel[0]-t[0],this.vel[1]-t[1]],this.changeDirection()}discharge(){this.flashLightPower>=0&&!this.mustRecharge?(this.flashLightPower-=1,console.log(this.flashLightPower)):(this.mustRecharge=!0,this.flashLightOn=!1)}recharge(){this.flashLightPower<100&&(this.flashLightPower+=.3,this.flashLightPower>50&&(this.mustRecharge=!1))}flashLight(){console.log(this.mustRecharge),this.flashLightOn?this.flashLightOn=!1:this.flashLightOn||this.mustRecharge||(this.flashLightOn=!0)}};Window.image=n;var u=class extends g{constructor(t,i=[0,0],e="left",h=0,o="attacking"){super(t,i,e,h),this.state=o,this.counter=0,this.hidingCounter=0,this.hitbox={x:15,y:11,radius:8},this.currentImage="",this.image=this.image.bind(this)}image(){return this.currentImage=n.boo[this.direction][this.state][this.imageCount],this.currentImage}nextMove(t,i){if(i)if("attacking"===this.state){let i=t.pos[0]-this.pos[0],e=t.pos[1]-this.pos[1],h=Math.sqrt(i*i+e*e);this.vel=[s*i/h/2,s*e/h/2],this.direction=i>0?"right":"left"}else"hiding"===this.state&&(this.vel=[0,0]);else this.vel=[0,0]}hide(){this.state="hiding",this.hidingCounter=0}incrementHiding(){this.hidingCounter++,this.hidingCounter>=300&&(this.state="attacking",this.hidingCounter=0)}move(){this.pos=[this.pos[0]+this.vel[0],this.pos[1]+this.vel[1]],this.counter++,this.counter>12&&(this.counter=0,this.imageCount=(this.imageCount+1)%n.boo[this.direction][this.state].length)}addVelocity(t){t=[t[0]*s,t[1]*s],this.vel=[this.vel[0]+t[0],this.vel[1]+t[1]],this.changeDirection()}removeVelocity(t){t=[t[0]*s,t[1]*s],this.vel=[this.vel[0]-t[0],this.vel[1]-t[1]],this.changeDirection()}checkCollision(t){let i=t.pos[0]+t.hitbox.x,e=(t.pos[0],t.hitbox.x,t.hitbox.width,t.pos[1]+t.hitbox.y),h=(t.pos[1],t.hitbox.y,t.hitbox.height,this.pos[0]+this.hitbox.x),o=(this.pos[0],this.hitbox.x,this.hitbox.width,this.pos[1]+this.hitbox.y),s=(this.pos[1],this.hitbox.y,this.hitbox.height,Math.abs(h-i-t.hitbox.width/2)),a=Math.abs(o-e-t.hitbox.height/2);if(s<t.hitbox.width/2+this.hitbox.radius&&a<t.hitbox.height/2+this.hitbox.radius)return!0}};class f{constructor(){this.mario=new m,this.boos=[],this.maxGhosts=20,this.addBoo(),this.darknessCounter=0,this.booRandomPosition=this.booRandomPosition.bind(this),this.dead=!1,this.checkCollisions=this.checkCollisions.bind(this),this.trueDarkness=this.trueDarkness.bind(this),this.flashlight=this.flashlight.bind(this),this.lightRange={},this.browserScaler=0,this.score=0,this.gameOverChange=!1}addBoo(){if(!this.dead){if(this.boos.length>this.maxGhosts){let t=Math.floor(Math.random()*this.maxGhosts);this.boos.splice(t,1)}this.boos.push(new u(this.booRandomPosition()))}}booRandomPosition(){let t=Math.floor(Math.random()*h),i=Math.floor(Math.random()*o),e=[t,i];return(this.mario.pos[0]>=t-r&&this.mario.pos[0]<=t+r||this.mario.pos[1]>=i-r&&this.mario.pos[1]<=i+r)&&(e=this.booRandomPosition()),e}draw(t){t.clearRect(0,0,h,o),t.fillStyle="#888888",t.fillRect(0,0,h,o),t.drawImage(this.mario.image(),this.mario.pos[0],this.mario.pos[1]);for(let i=0;i<this.boos.length;i++){let e=this.boos[i];e.nextMove(this.mario,!this.dead),t.drawImage(e.image(),e.pos[0],e.pos[1])}this.dead?this.dead&&this.darknessCounter<50?this.trueDarkness(t):this.darknessCounter>=50&&this.browserScaler<2.5&&this.gameOverScreen(t):this.drawDarkness(t),this.browserScaler>=3&&(this.gameOverChange=!0)}drawDarkness(t){let i=this.mario.pos[0]+14,e=this.mario.pos[1]+20;t.beginPath(),t.arc(i,e,100,0,2*Math.PI,!0),t.moveTo(i,e),this.mario.flashLightOn&&this.flashlight(t),t.rect(h,o,-h,-o),t.fillStyle="black",t.fill(),t.closePath(),t.beginPath();let s=t.createRadialGradient(i,e,50,i,e,120);if(s.addColorStop(0,"transparent"),s.addColorStop(1,"black"),t.fillStyle=s,t.moveTo(i,e),this.mario.flashLightOn?this.flashlight2(t):t.arc(i,e,100,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),this.mario.flashLightOn){let h=t.createLinearGradient(i,e,150,0);h.addColorStop(0,"rgba(255, 255, 220, 0.2)"),h.addColorStop(1,"rgba(0, 0, 0, 0.2)"),t.moveTo(i,e),this.flashligh3(t),t.fillStyle="rgba(255, 255, 200, 0.4)",t.fill()}}trueDarkness(t){this.darknessCounter+=.5;let i=this.mario.pos[0]+14,e=this.mario.pos[1]+20;t.beginPath(),t.fillStyle="black",t.arc(i,e,100,0,2*Math.PI),t.rect(h,0,-h,o),t.fill(),t.closePath(),t.beginPath();let s=t.createRadialGradient(i,e,50-this.darknessCounter,i,e,100-2*this.darknessCounter);s.addColorStop(0,"transparent"),s.addColorStop(1,"black"),t.fillStyle=s,t.arc(i,e,120,0,2*Math.PI),t.fill(),t.closePath()}gameOverScreen(t){t.fillStyle="black",t.fillRect(0,0,h,o);let i=n.game_over[0],e=i.width*this.browserScaler,s=i.height*this.browserScaler;t.drawImage(i,h/2-e/2,o/2-s/2,e,s),this.browserScaler+=.01}flashlight(t){let i,e,h,o,s=this.mario.pos[0]+14,a=this.mario.pos[1]+20;"down"===this.mario.direction?(i=s-200*Math.tan(22.5*Math.PI/180),e=a+200,h=s+200*Math.tan(22.5*Math.PI/180),o=a+200,t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a),t.arc(s,a,100,3*Math.PI/8,5*Math.PI/8)):"downright"===this.mario.direction?(i=s+200*Math.tan(22.5*Math.PI/180),e=a+200,h=s+200,o=a+200*Math.tan(22.5*Math.PI/180),t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a),t.arc(s,a,100,Math.PI/8,3*Math.PI/8)):"right"===this.mario.direction?(i=s+200,e=a+200*Math.tan(22.5*Math.PI/180),h=s+200,o=a-200*Math.tan(22.5*Math.PI/180),t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a),t.arc(s,a,100,15*Math.PI/8,Math.PI/8)):"upright"===this.mario.direction?(i=s+200,e=a-200*Math.tan(22.5*Math.PI/180),h=s+200*Math.tan(22.5*Math.PI/180),o=a-200,t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a),t.arc(s,a,100,13*Math.PI/8,15*Math.PI/8)):"up"===this.mario.direction?(i=s+200*Math.tan(22.5*Math.PI/180),e=a-200,h=s-200*Math.tan(22.5*Math.PI/180),o=a-200,t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a),t.arc(s,a,100,11*Math.PI/8,13*Math.PI/8)):"upleft"===this.mario.direction?(i=s-200*Math.tan(22.5*Math.PI/180),e=a-200,h=s-200,o=a-200*Math.tan(22.5*Math.PI/180),t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a),t.arc(s,a,100,9*Math.PI/8,11*Math.PI/8)):"left"===this.mario.direction?(i=s-200,e=a-200*Math.tan(22.5*Math.PI/180),h=s-200,o=a+200*Math.tan(22.5*Math.PI/180),t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a),t.arc(s,a,100,7*Math.PI/8,9*Math.PI/8)):"downleft"===this.mario.direction&&(i=s-200,e=a+200*Math.tan(22.5*Math.PI/180),h=s-200*Math.tan(22.5*Math.PI/180),o=a+200,t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a),t.arc(s,a,100,5*Math.PI/8,7*Math.PI/8)),this.lightRange={point1:[s,a],point2:[i,e],point3:[h,o]}}flashlight2(t){let i=this.mario.pos[0]+14,e=this.mario.pos[1]+20;"down"===this.mario.direction?t.arc(i,e,100,3*Math.PI/8,5*Math.PI/8,!0):"downright"===this.mario.direction?t.arc(i,e,100,Math.PI/8,3*Math.PI/8,!0):"right"===this.mario.direction?t.arc(i,e,100,15*Math.PI/8,Math.PI/8,!0):"upright"===this.mario.direction?t.arc(i,e,100,13*Math.PI/8,15*Math.PI/8,!0):"up"===this.mario.direction?t.arc(i,e,100,11*Math.PI/8,13*Math.PI/8,!0):"upleft"===this.mario.direction?t.arc(i,e,100,9*Math.PI/8,11*Math.PI/8,!0):"left"===this.mario.direction?t.arc(i,e,100,7*Math.PI/8,9*Math.PI/8,!0):"downleft"===this.mario.direction&&t.arc(i,e,100,5*Math.PI/8,7*Math.PI/8,!0)}flashligh3(t){let i,e,h,o,s=this.mario.pos[0]+14,a=this.mario.pos[1]+20;"down"===this.mario.direction?(i=s-200*Math.tan(22.5*Math.PI/180),e=a+200,h=s+200*Math.tan(22.5*Math.PI/180),o=a+200,t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a)):"downright"===this.mario.direction?(i=s+200*Math.tan(22.5*Math.PI/180),e=a+200,h=s+200,o=a+200*Math.tan(22.5*Math.PI/180),t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a)):"right"===this.mario.direction?(i=s+200,e=a+200*Math.tan(22.5*Math.PI/180),h=s+200,o=a-200*Math.tan(22.5*Math.PI/180),t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a)):"upright"===this.mario.direction?(i=s+200,e=a-200*Math.tan(22.5*Math.PI/180),h=s+200*Math.tan(22.5*Math.PI/180),o=a-200,t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a)):"up"===this.mario.direction?(i=s+200*Math.tan(22.5*Math.PI/180),e=a-200,h=s-200*Math.tan(22.5*Math.PI/180),o=a-200,t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a)):"upleft"===this.mario.direction?(i=s-200*Math.tan(22.5*Math.PI/180),e=a-200,h=s-200,o=a-200*Math.tan(22.5*Math.PI/180),t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a)):"left"===this.mario.direction?(i=s-200,e=a-200*Math.tan(22.5*Math.PI/180),h=s-200,o=a+200*Math.tan(22.5*Math.PI/180),t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a)):"downleft"===this.mario.direction&&(i=s-200,e=a+200*Math.tan(22.5*Math.PI/180),h=s-200*Math.tan(22.5*Math.PI/180),o=a+200,t.lineTo(i,e),t.lineTo(h,o),t.moveTo(s,a))}checkInLight(t){if(t=[t[0]+10,t[1]+10],!this.mario.flashLightOn)return;let i=this.lightRange.point1,e=this.lightRange.point2,h=this.lightRange.point3;return this.triangleArea(i,e,h)===this.triangleArea(i,e,t)+this.triangleArea(i,h,t)+this.triangleArea(e,h,t)}triangleArea(t,i,e){let h=(t[0]*(i[1]-e[1])+i[0]*(e[1]-t[1])+e[0]*(t[1]-i[1]))/2;return Math.abs(h)}moveObjects(){for(let t=0;t<this.allObjects().length;t++)this.allObjects()[t].move()}checkCollisions(){for(let t=0;t<this.boos.length;t++)this.boos[t].checkCollision(this.mario)?this.gameOver():this.checkInLight(this.boos[t].pos)?this.boos[t].hide():"hiding"===this.boos[t].state&&this.boos[t].incrementHiding()}step(){this.moveObjects(),this.checkCollisions()}allObjects(){let t=Object.assign([],this.boos);return t.push(this.mario),t}gameOver(){this.mario.vel=[0,0],this.dead=!0}}const p=t=>{M(t),b(t),P(t)},M=t=>{t.clearRect(0,0,h,o),t.fillStyle="black",t.fillRect(0,0,h,o)},b=t=>{t.beginPath(),t.fillStyle="white",t.textAlign="center",t.shadowColor="white",t.shadowBlur=10,t.font="80px SuperMario256",t.fillText("Boo",h/2,150),t.closePath()},P=t=>{t.beginPath(),t.strokeStyle="white",t.fillStyle="white",t.textAlign="center",t.font="30px SuperMario256";const i="Press ENTER to begin";t.shadowColor="white",t.shadowBlur=10,t.fillText(i,h/2,250),t.closePath();const e=t.measureText(i).width,o=h/2-e/2;t.beginPath(),t.textAlign="left",t.font="30px SuperMario256",t.fillText("Instructions",o,340),t.fillText("Controls",o,450),t.font="20px SuperMario256",t.fillText("- Avoid boos at all costs",o+20,370),t.fillText("- Use your flashlight to stun boos",o+20,400),t.fillText("- WASD to MOVE",o+20,480),t.fillText("- SPACE to TURN ON FLASHLIGHT",o+20,510),t.fillStyle="",t.shadowBlur="",t.closePath()},v=(t,i)=>{w(t),I(t),T(t,i)},w=t=>{t.clearRect(0,0,h,o),t.fillStyle="black",t.fillRect(0,0,h,o)},I=t=>{t.beginPath(),t.fillStyle="white",t.textAlign="center",t.shadowColor="white",t.shadowBlur=10,t.font="50px SuperMario256",t.fillText("Game Over",h/2,150),t.closePath()},T=(t,i)=>{t.beginPath(),t.strokeStyle="white",t.fillStyle="white",t.textAlign="center",t.font="50px SuperMario256";const e="Press ENTER to play again";t.shadowColor="white",t.shadowBlur=10,t.fillText(e,h/2,450),t.closePath();t.measureText(e).width;t.beginPath(),t.font="30px SuperMario256",t.fillText("Score: "+i,h/2,240),t.fillStyle="",t.shadowBlur="",t.closePath()};class y{constructor(t){this.game=new f,this.ctx=t,this.mario=this.game.mario,this.state="title",this.keyDown={},this.handleKeydown=this.handleKeydown.bind(this),this.handleKeyup=this.handleKeyup.bind(this),this.ghostCounter=0,this.flashlightCounter=0,this.step=this.step.bind(this),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup)}start(){d(()=>{requestAnimationFrame(this.step)})}step(){switch(this.state){case"title":p(this.ctx);break;case"game":this.ghostCounter++,this.ghostCounter>20&&(this.ghostCounter=0,this.game.addBoo()),this.game.draw(this.ctx),this.game.step(),this.mario.flashLightOn?this.mario.discharge():this.mario.recharge(),this.game.dead||this.game.score++,this.game.gameOverChange&&(this.state="gameOver");break;case"gameOver":v(this.ctx,this.game.score)}requestAnimationFrame(this.step)}handleKeydown(t){if(!t.repeat&&!this.keyDown[t.keyCode]&&(t.keyCode===l.ENTER&&("title"!==this.state&&"gameOver"!==this.state||(this.state="game",this.game=new f,this.mario=this.game.mario,this.keyDown={})),!this.game.dead))switch(t.keyCode){case l.W:this.mario.addVelocity(c.UP),this.keyDown[l.W]=!0;break;case l.A:this.mario.addVelocity(c.LEFT),this.keyDown[l.A]=!0;break;case l.S:this.mario.addVelocity(c.DOWN),this.keyDown[l.S]=!0;break;case l.D:this.mario.addVelocity(c.RIGHT),this.keyDown[l.D]=!0;break;case l.SPACE:this.mario.flashLight(),this.keyDown[l.SPACE]=!0}}handleKeyup(t){if(!this.game.dead)switch(t.keyCode){case l.W:this.mario.removeVelocity(c.UP),this.keyDown[l.W]=!1;break;case l.A:this.mario.removeVelocity(c.LEFT),this.keyDown[l.A]=!1;break;case l.S:this.mario.removeVelocity(c.DOWN),this.keyDown[l.S]=!1;break;case l.D:this.mario.removeVelocity(c.RIGHT),this.keyDown[l.D]=!1;break;case l.SPACE:this.mario.flashLight(),this.keyDown[l.SPACE]=!1}}}document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("game-canvas");t.width=h,t.height=o;const i=t.getContext("2d");new y(i).start()})}]);